{
  "id": "user-memory",
  "name": "User Memory",
  "subtitle": "Постоянная память пользователя",
  "description": "Сохраняет, ищет, выводит списком и удаляет факты о пользователе для персонализированных ответов.",
  "homepage": "",
  "manifest_url": "",
  "repo_url": "",
  "package_url": "",
  "source": "user",
  "preinstalled": false,
  "enabled": true,
  "tools": [
    {
      "name": "memory.remember",
      "description": "Сохраняет персональный факт о пользователе. Используй только при явной просьбе сохранить факт.",
      "input_schema": {
        "type": "object",
        "properties": {
          "fact": {
            "type": "string",
            "description": "Персональный факт о пользователе, который нужно сохранить."
          },
          "key": {
            "type": "string",
            "description": "Опциональный стабильный ключ факта (например name, city, phone, profession)."
          },
          "tags": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Опциональные теги для классификации записи."
          },
          "importance": {
            "type": "integer",
            "minimum": 1,
            "maximum": 5,
            "default": 3,
            "description": "Важность факта от 1 до 5."
          },
          "overwrite_key": {
            "type": "boolean",
            "default": true,
            "description": "Если true, запись с тем же key для пользователя будет обновлена."
          }
        },
        "required": [
          "fact"
        ],
        "additionalProperties": false
      },
      "runtime_meta": {
        "display_name": "User Memory",
        "subtitle": "Сохранение фактов о пользователе",
        "category": "system",
        "keywords": [
          "память",
          "запомнить",
          "сохранить",
          "профиль",
          "пользователь"
        ],
        "requires_network": false,
        "aliases": [
          "memory.user.remember",
          "memory.remember",
          "user.memory.remember",
          "remember",
          "user.remember",
          "memory.save"
        ],
        "auto_invoke": {
          "enabled": true,
          "triggers": [
            "запомни",
            "remember",
            "сохрани в памяти"
          ],
          "args": {
            "fact": {
              "source": "user_text",
              "strip_prefixes": [
                "запомни, что",
                "запомни что",
                "запомни",
                "remember that",
                "remember",
                "сохрани в памяти, что",
                "сохрани в памяти что",
                "сохрани в памяти"
              ]
            }
          }
        },
        "prompt": "Алгоритм memory.remember: 1) Вызывай только при прямой команде сохранить факт о пользователе (\"запомни\", \"remember\", \"сохрани в памяти\"). 2) Сохраняй только факт о пользователе, а не о модели; фразы вида \"ты ...\" не сохраняй. 3) Не вызывай для вопросов, команд показать/вспомнить/удалить память или для мета-реплик. 4) Сначала вызови инструмент, затем подтверждай сохранение."
      },
      "handler": {
        "type": "python",
        "module_file": "plugin.py",
        "callable": "remember"
      },
      "llm_schema": {
        "type": "function",
        "function": {
          "name": "memory.remember",
          "description": "Сохраняет факт о пользователе только по явной команде пользователя запомнить/сохранить информацию о себе.",
          "parameters": {
            "type": "object",
            "properties": {
              "fact": {
                "type": "string",
                "description": "Персональный факт о пользователе для сохранения."
              },
              "key": {
                "type": "string",
                "description": "Опциональный ключ факта (name/city/phone/profession и т.п.)."
              },
              "tags": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Опциональные теги записи."
              },
              "importance": {
                "type": "integer",
                "minimum": 1,
                "maximum": 5,
                "default": 3,
                "description": "Важность факта от 1 до 5."
              },
              "overwrite_key": {
                "type": "boolean",
                "default": true,
                "description": "Если true, запись с тем же key будет обновлена."
              }
            },
            "required": [
              "fact"
            ],
            "additionalProperties": false
          }
        }
      }
    },
    {
      "name": "memory.recall",
      "description": "Находит релевантные сохранённые факты о пользователе по запросу/ключу.",
      "input_schema": {
        "type": "object",
        "properties": {
          "query": {
            "type": "string",
            "description": "Поисковый запрос по памяти (например 'телефон', 'где я живу')."
          },
          "key": {
            "type": "string",
            "description": "Точный ключ записи (например phone, city, profession)."
          },
          "tags": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Опциональный фильтр по тегам."
          },
          "limit": {
            "type": "integer",
            "minimum": 1,
            "maximum": 20,
            "default": 5,
            "description": "Максимум записей в ответе."
          },
          "scope": {
            "type": "string",
            "enum": [
              "current_user",
              "all"
            ],
            "default": "current_user",
            "description": "current_user — только текущий пользователь, all — все пользователи."
          }
        },
        "required": [],
        "additionalProperties": false
      },
      "runtime_meta": {
        "display_name": "User Memory",
        "subtitle": "Поиск фактов о пользователе",
        "category": "system",
        "keywords": [
          "память",
          "вспомни",
          "напомни",
          "профиль",
          "что ты помнишь"
        ],
        "requires_network": false,
        "aliases": [
          "memory.user.recall",
          "memory.recall",
          "user.memory.recall",
          "recall",
          "memory.read",
          "remember.about.user"
        ],
        "auto_invoke": {
          "enabled": true,
          "triggers": [
            "что ты помнишь",
            "что ты знаешь обо мне",
            "что ты обо мне помнишь",
            "напомни",
            "какой у меня",
            "какая у меня",
            "какое у меня",
            "кто я",
            "мой телефон",
            "my phone",
            "what do you remember"
          ],
          "args": {
            "query": {
              "source": "user_text",
              "strip_prefixes": [
                "что ты помнишь обо мне",
                "что ты обо мне помнишь",
                "что ты помнишь",
                "что ты знаешь обо мне",
                "напомни",
                "какой у меня",
                "какая у меня",
                "какое у меня",
                "кто я",
                "мой телефон",
                "what do you remember about me",
                "what do you remember",
                "my phone"
              ]
            }
          }
        },
        "prompt": "Вызывай memory.recall для вопросов о фактах пользователя (например: \"какой у меня телефон\", \"кто я\", \"что ты обо мне помнишь\"). Если вопрос общий, можно передать пустой или короткий query. Если пользователь просит показать весь список памяти, используй memory.list."
      },
      "handler": {
        "type": "python",
        "module_file": "plugin.py",
        "callable": "recall"
      },
      "llm_schema": {
        "type": "function",
        "function": {
          "name": "memory.recall",
          "description": "Ищет релевантные записи памяти пользователя и возвращает факты для ответа на вопрос о пользователе.",
          "parameters": {
            "type": "object",
            "properties": {
              "query": {
                "type": "string",
                "description": "Поисковый запрос по сохранённой памяти."
              },
              "key": {
                "type": "string",
                "description": "Точный ключ записи."
              },
              "tags": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Опциональный фильтр по тегам."
              },
              "limit": {
                "type": "integer",
                "minimum": 1,
                "maximum": 20,
                "default": 5,
                "description": "Максимум записей в ответе."
              },
              "scope": {
                "type": "string",
                "enum": [
                  "current_user",
                  "all"
                ],
                "default": "current_user",
                "description": "Область поиска памяти."
              }
            },
            "required": [],
            "additionalProperties": false
          }
        }
      }
    },
    {
      "name": "memory.list",
      "description": "Выводит список сохранённых записей памяти пользователя (без поискового запроса).",
      "input_schema": {
        "type": "object",
        "properties": {
          "limit": {
            "type": "integer",
            "minimum": 1,
            "maximum": 200,
            "default": 20,
            "description": "Максимум записей в ответе."
          },
          "offset": {
            "type": "integer",
            "minimum": 0,
            "maximum": 2000,
            "default": 0,
            "description": "Смещение для постраничного просмотра."
          },
          "scope": {
            "type": "string",
            "enum": [
              "current_user",
              "all"
            ],
            "default": "current_user",
            "description": "current_user — память текущего пользователя, all — всех пользователей."
          }
        },
        "required": [],
        "additionalProperties": false
      },
      "runtime_meta": {
        "display_name": "User Memory",
        "subtitle": "Список всех записей памяти",
        "category": "system",
        "keywords": [
          "память",
          "список",
          "все записи",
          "покажи всё"
        ],
        "requires_network": false,
        "aliases": [
          "memory.user.list",
          "memory.list",
          "user.memory.list",
          "memory.all",
          "memory.export"
        ],
        "auto_invoke": {
          "enabled": true,
          "triggers": [
            "что ты запомнил",
            "покажи всё",
            "покажи все",
            "покажи всю память",
            "покажи память",
            "выведи память",
            "show all memories",
            "list memory",
            "what have you remembered"
          ],
          "args": {}
        },
        "prompt": "Вызывай memory.list только для запроса полного списка памяти (\"покажи всё\", \"что ты запомнил\", \"выведи память\"). Для ответа на конкретный факт используй memory.recall. Не используй memory.list для сохранения или удаления."
      },
      "handler": {
        "type": "python",
        "module_file": "plugin.py",
        "callable": "list_memories"
      },
      "llm_schema": {
        "type": "function",
        "function": {
          "name": "memory.list",
          "description": "Показывает полный или постраничный список сохранённых записей памяти пользователя.",
          "parameters": {
            "type": "object",
            "properties": {
              "limit": {
                "type": "integer",
                "minimum": 1,
                "maximum": 200,
                "default": 20,
                "description": "Максимум записей в ответе."
              },
              "offset": {
                "type": "integer",
                "minimum": 0,
                "maximum": 2000,
                "default": 0,
                "description": "Смещение для постраничного просмотра."
              },
              "scope": {
                "type": "string",
                "enum": [
                  "current_user",
                  "all"
                ],
                "default": "current_user",
                "description": "Область выборки памяти."
              }
            },
            "required": [],
            "additionalProperties": false
          }
        }
      }
    },
    {
      "name": "memory.forget",
      "description": "Удаляет записи памяти по id, key или текстовому запросу, когда пользователь просит забыть информацию.",
      "input_schema": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "Идентификатор записи для удаления."
          },
          "key": {
            "type": "string",
            "description": "Удалить запись(и) по ключу."
          },
          "query": {
            "type": "string",
            "description": "Удалить запись(и), соответствующие текстовому запросу."
          },
          "all_matching": {
            "type": "boolean",
            "default": false,
            "description": "Если true, удалить все совпадения."
          },
          "scope": {
            "type": "string",
            "enum": [
              "current_user",
              "all"
            ],
            "default": "current_user",
            "description": "Область удаления памяти."
          }
        },
        "required": [],
        "additionalProperties": false
      },
      "runtime_meta": {
        "display_name": "User Memory",
        "subtitle": "Удаление фактов о пользователе",
        "category": "system",
        "keywords": [
          "память",
          "забыть",
          "удалить",
          "приватность"
        ],
        "requires_network": false,
        "aliases": [
          "memory.user.forget",
          "memory.forget",
          "user.memory.forget",
          "forget",
          "memory.delete",
          "memory.remove"
        ],
        "prompt": "Вызывай memory.forget только по явному запросу удалить/забыть память. Приоритет аргументов: сначала id, затем key, затем query. Не вызывай для чтения или сохранения памяти."
      },
      "handler": {
        "type": "python",
        "module_file": "plugin.py",
        "callable": "forget"
      },
      "llm_schema": {
        "type": "function",
        "function": {
          "name": "memory.forget",
          "description": "Удаляет одну или несколько записей из памяти пользователя по id, key или query.",
          "parameters": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string",
                "description": "Идентификатор записи для удаления."
              },
              "key": {
                "type": "string",
                "description": "Удаление по ключу."
              },
              "query": {
                "type": "string",
                "description": "Удаление по текстовому совпадению."
              },
              "all_matching": {
                "type": "boolean",
                "default": false,
                "description": "Если true, удаляет все совпавшие записи."
              },
              "scope": {
                "type": "string",
                "enum": [
                  "current_user",
                  "all"
                ],
                "default": "current_user",
                "description": "Область удаления."
              }
            },
            "required": [],
            "additionalProperties": false
          }
        }
      }
    }
  ],
  "ui_extensions": [
    {
      "type": "script",
      "path": "ui/tool-ui.js",
      "url": "",
      "load": "script"
    }
  ],
  "version": "1.0.0",
  "category": "system",
  "keywords": [
    "память",
    "профиль",
    "запомнить",
    "вспомнить",
    "показать всё",
    "забыть",
    "пользователь"
  ],
  "locked": false,
  "allow_update": true,
  "requires_network": false
}
